<html>
 <head>
  <script src="http://localhost:8001/static/hookbox.js"></script>
  <script>
   doChat = function() {
       var el = document.getElementById('chat_input');
       conn.publish('testing', el.value);
   };
   onload = function() {
				hookbox.logging.get('hookbox').setLevel(hookbox.logging.DEBUG);
				hookbox.logging.get('net.protocols.rtjp').setLevel(hookbox.logging.DEBUG);
				conn = hookbox.connect('http://localhost:8001/csp');
				conn.onsubscribed = function(channel_name, s) {
					console.log('blah');
					s.onFrame = function(frame) {
							console.log('...');
							var d = document.createElement('div');
							d.innerHTML = frame.user + ': ' + frame.payload;
							var h = document.getElementById('history');
							var shouldScroll = (h.scrollTop + h.offsetHeight) == h.scrollHeight;
							h.appendChild(d);
							if (shouldScroll) { h.scrollTop = h.scrollHeight; }
					};
					s.onFailure = function(msg) {
							alert('Error: ' + msg);
					}
				}
				conn.subscribe('testing');
				conn.onerror = function(frame) { alert("Error: " + frame.msg); }
	 }

  </script>
 </head>
 <body>
  <h1>PHP Hookbox Chat</h1>
  <div id="history" style="height: 200px; width: 300px; overflow-y: scroll">
  </div>
  <input type="text" id="chat_input" /><input type="submit" onClick="doChat();" /><br/>

 </body>
</html>
