;(function(){var preloaded_source={'jsio.env.':{"url":"jsio/env/__init__.js","src":"\nrequire('jsio',['getEnvironment','log','bind']);function getObj(objectName,transportName,envName){envName=envName||getEnvironment();try{var what={};what[objectName]='result';require('.'+envName+'.'+transportName,what);}catch(e){throw e;throw new Error('No '+objectName+' found for '+transportName+' in '+envName);}\nreturn result;}\nexports.getListener=bind(this,getObj,'Listener');exports.getConnector=bind(this,getObj,'Connector');"},'jsio.protocols.delimited':{"url":"jsio/protocols/delimited.js","src":"\nrequire('jsio',['Class','log']);require('jsio.logging');require('jsio.interfaces');var logger=jsio.logging.getLogger('DelimitedProtocol')\nexports.DelimitedProtocol=Class(jsio.interfaces.Protocol,function(supr){this.init=function(delimiter){if(!delimiter){delimiter='\\r\\n'}\nthis.delimiter=delimiter;this.buffer=\"\"}\nthis.connectionMade=function(){logger.debug('connectionMade');}\nthis.dataReceived=function(data){logger.debug('dataReceived:',JSON.stringify(data));this.buffer+=data;var i;while((i=this.buffer.indexOf(this.delimiter))!=-1){var line=this.buffer.slice(0,i);this.buffer=this.buffer.slice(i+this.delimiter.length);this.lineReceived(line);}}\nthis.lineReceived=function(line){logger.debug('Not implemented, lineReceived:',line);}\nthis.connectionLost=function(){logger.debug('connectionLost');}});"},'jsio.logging':{"url":"jsio/logging.js","src":"\nrequire('jsio',['Class','log']);var loggers={}\nvar levels=exports.levels={DEBUG:0,LOG:1,INFO:2,WARN:3,ERROR:4};exports.getLogger=function(name){if(!(name in loggers)){loggers[name]=new exports.Logger(name);}\nreturn loggers[name];}\nexports.Logger=Class(function(){this.init=function(name,level){if(!level){level=levels.LOG;}\nthis.name=name;this.level=level;}\nthis.setLevel=function(level){this.level=level;}\nfunction makeLogFunction(level,type){var a=[];return function(){if(level<this.level)return;a.splice.call(arguments,0,0,type,this.name)\nlog.apply(log,arguments);}}\nthis.debug=makeLogFunction(levels.DEBUG,\"DEBUG\");this.log=makeLogFunction(levels.LOG,\"LOG\");this.info=makeLogFunction(levels.INFO,\"INFO\");this.warn=makeLogFunction(levels.WARN,\"WARN\");this.error=makeLogFunction(levels.ERROR,\"ERROR\");})"},'jsio.base64':{"url":"jsio/base64.js","src":"\n(function(){var alphabet='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdef'+'ghijklmnopqrstuvwxyz0123456789-_';var pad='=';var UnicodeCodecError=this.UnicodeCodecError=function(message){this.message=message;};this.UnicodeCodecError.prototype.toString=function(){return'UnicodeCodecError'+(this.message?': '+this.message:'');};var shorten=function(array,number){for(var i=number;i>0;i--){array.pop();};};var decode_map={};for(var i=0,n=alphabet.length;i<n;i++){decode_map[alphabet[i]]=i;};var alphabet_inverse=new RegExp('[^'+alphabet+']');var Base64CodecError=this.Base64CodecError=function(message){this.message=message;};Base64CodecError.prototype.toString=function(){return'Base64CodecError'+(this.message?': '+this.message:'');};var assertOrBadInput=function(exp,message){if(!exp){throw new Base64CodecError(message)};};this.encode=function(bytes){assertOrBadInput(!(/[^\\x00-\\xFF]/.test(bytes)),'Input contains out-of-range characters.');var padding='\\x00\\x00\\x00'.slice((bytes.length%3)||3);bytes+=padding;var out_array=[];for(var i=0,n=bytes.length;i<n;i+=3){var newchars=((bytes.charCodeAt(i)<<020)+\n(bytes.charCodeAt(i+1)<<010)+\n(bytes.charCodeAt(i+2)));out_array.push(alphabet[(newchars>>18)&077],alphabet[(newchars>>12)&077],alphabet[(newchars>>6)&077],alphabet[(newchars)&077]);};shorten(out_array,padding.length);return out_array.join('');};this.decode=function(b64text){b64text=b64text.replace(/\\s/g,'')\nvar i=b64text.length;while(b64text[--i]===pad){};b64text=b64text.slice(0,i+1);assertOrBadInput(!alphabet_inverse.test(b64text),'Input contains out-of-range characters.');var padding=Array(5-((b64text.length%4)||4)).join(alphabet[alphabet.length-1]);b64text+=padding;var out_array=[];for(var i=0,n=b64text.length;i<n;i+=4){newchars=((decode_map[b64text[i]]<<18)+\n(decode_map[b64text[i+1]]<<12)+\n(decode_map[b64text[i+2]]<<6)+\n(decode_map[b64text[i+3]]));out_array.push((newchars>>020)&0xFF,(newchars>>010)&0xFF,(newchars)&0xFF);};shorten(out_array,padding.length);return String.fromCharCode.apply(String,out_array);};}).call(typeof(exports)!='undefined'?exports:(function(){window.base64={};return base64;})())"},'jsio.interfaces':{"url":"jsio/interfaces.js","src":"\nrequire('jsio',['Class'])\nexports.Protocol=Class(function(){this.connectionMade=function(isReconnect){}\nthis.dataReceived=function(data){}\nthis.connectionLost=function(reason){}\nthis.connectionFailed=function(){}});exports.Server=Class(function(){this.init=function(protocolClass){this._protocolClass=protocolClass;}\nthis.buildProtocol=function(){return new this._protocolClass();}});exports.Transport=Class(function(){this.write=function(data,encoding){throw new Error(\"Not implemented\");}\nthis.getPeer=function(){throw new Error(\"Not implemented\");}});exports.Listener=Class(function(){this.init=function(server,opts){this._server=server;this._opts=opts||{};}\nthis.onConnect=function(transport){var p=this._server.buildProtocol();p.transport=transport;p.server=this._server;transport.protocol=p;transport.makeConnection(p);p.connectionMade();}\nthis.listen=function(){throw new Error('Abstract class');}\nthis.stop=function(){}});exports.Connector=Class(function(){this.init=function(protocol,opts){this._protocol=protocol;this._opts=opts;}\nthis.onConnect=function(transport){transport.makeConnection(this._protocol);this._protocol.transport=transport;this._protocol.connectionMade();}\nthis.getProtocol=function(){return this._protocol;}});exports.PubSub=Class(function(){this.publish=function(signal){if(!this._subscribers){return;}\nvar args=Array.prototype.slice.call(arguments,1);if(this._subscribers.__any){var anyArgs=[signal].concat(args);for(var i=0,sub;sub=this._subscribers.__any[i];++i){sub.apply(window,args);}}\nif(!this._subscribers[signal]){return;}\nfor(var i=0,sub;sub=this._subscribers[signal][i];++i){sub.apply(window,args);}}\nthis.subscribe=function(signal){if(!this._subscribers){this._subscribers={};}\nif(!this._subscribers[signal]){this._subscribers[signal]=[];}\nthis._subscribers[signal].push(bind.apply(jsio,Array.prototype.slice.call(arguments,1)));}});"},'jsio.csp.client':{"url":"jsio/csp/client.js","src":";(function(global){var BACKOFF=50;var log=function(){if(typeof console!='undefined'&&console.log){console.log.apply(console,arguments);}}\nif(!global.csp){global.csp={}}\nvar csp=this;if(typeof(require)!='undefined'&&require.__jsio){require('..base64');require('..utf8')}\nvar id=0;csp.readyState={'initial':0,'opening':1,'open':2,'closing':3,'closed':4};csp.util={};(function(){function parseUri(str){var o=parseUri.options,m=o.parser[o.strictMode?\"strict\":\"loose\"].exec(str),uri={},i=14;while(i--)uri[o.key[i]]=m[i]||\"\";uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1)uri[o.q.name][$1]=$2;});return uri;};parseUri.options={strictMode:false,key:[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"],q:{name:\"queryKey\",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/}};csp.util.parseUri=parseUri;})();csp.util.isSameDomain=function(urlA,urlB){var a=csp.util.parseUri(urlA);var b=csp.util.parseUri(urlB);return((urlA.port==urlB.port)&&(urlA.host==urlB.host)&&(urlA.protocol=urlB.protocol))}\ncsp.util.chooseTransport=function(url,options){var test=location.toString().match('file://');if(test&&test.index===0){return transports.jsonp}\nif(csp.util.isSameDomain(url,location.toString())){return transports.xhr;}\ntry{if(window.XMLHttpRequest&&(new XMLHttpRequest()).withCredentials!==undefined){return transports.xhr;}}catch(e){}\nreturn transports.jsonp}\nvar PARAMS={'xhrstream':{\"is\":\"1\",\"bs\":\"\\n\"},'xhrpoll':{\"du\":\"0\"},'xhrlongpoll':{},'sselongpoll':{\"bp\":\"data: \",\"bs\":\"\\r\\n\",\"se\":\"1\"},'ssestream':{\"bp\":\"data: \",\"bs\":\"\\r\\n\",\"se\":\"1\",\"is\":\"1\"}};csp.CometSession=function(){var self=this;self.id=++id;self.url=null;self.readyState=csp.readyState.initial;self.sessionKey=null;var transport=null;var options=null;var buffer=\"\";self.write=function(){throw new Error(\"invalid readyState\");}\nself.onopen=function(){}\nself.onclose=function(code){}\nself.onread=function(data){}\nself.setEncoding=function(encoding){switch(encoding){case'plain':if(buffer){self.onread(buffer);buffer=\"\";}\nbreak;case'utf8':break\ndefault:throw new Error(\"Invalid encoding\")}\noptions.encoding=encoding;}\nvar transport_onread=function(data){if(options.encoding=='utf8'){self.onread(utf8.decode(data)[0]);}\nelse if(options.encoding=='plain'){self.onread(data);}}\nself.write=function(data){switch(options.encoding){case'plain':transport.send(data);break;case'utf8':transport.send(utf8.encode(data));break;}}\nself.connect=function(url,_options){options=_options||{};if(!options.encoding){options.encoding='utf8'}\nvar timeout=options.timeout||10000;self.readyState=csp.readyState.opening;self.url=url;transport=new(csp.util.chooseTransport(url,options))(self.id,url,options);var handshakeTimer=window.setTimeout(self.close,timeout);transport.onHandshake=function(data){self.readyState=csp.readyState.open;self.sessionKey=data.session;transport.onPacket=transport_onread;transport.resume(self.sessionKey,0,0);clearTimeout(handshakeTimer);self.onopen();}\ntransport.handshake();}\nself.close=function(){transport.close();self.readyState=csp.readyState.closed;self.onclose();}}\nvar Transport=function(cspId,url){var self=this;self.opened=false;self.cspId=cspId;self.url=url;self.buffer=\"\";self.packetsInFlight=null;self.sending=false;self.sessionKey=null;self.lastEventId=null;this.handshake=function(){self.opened=true;}\nself.processPackets=function(packets){for(var i=0;i<packets.length;i++){var p=packets[i];if(p===null)\nreturn self.doClose();var ackId=p[0];var encoding=p[1];var data=p[2];if(self.lastEventId!=null&&ackId<=self.lastEventId)\ncontinue;if(self.lastEventId!=null&&ackId!=self.lastEventId+1)\nthrow new Error(\"CSP Transport Protocol Error\");self.lastEventId=ackId;if(encoding==1){try{data=base64.decode(data);}catch(e){self.close()\nreturn;}}\nself.onPacket(data);}}\nself.resume=function(sessionKey,lastEventId,lastSentId){self.sessionKey=sessionKey;self.lastEventId=lastEventId;self.lastSentId=lastSentId;self.reconnect();}\nself.send=function(data){self.buffer+=data;if(!self.packetsInFlight){self.doSend();}}\nself.doSend=function(){throw new Error(\"Not Implemented\");}\nself.close=function(){self.stop();}\nself.stop=function(){self.opened=false;clearTimeout(cometTimer);clearTimeout(sendTimer);clearTimeout(handshakeTimer);}\nvar cometBackoff=BACKOFF;var backoff=BACKOFF;var handshakeTimer=null;var sendTimer=null;var cometTimer=null;self.handshakeCb=function(data){if(self.opened){self.onHandshake(data);backoff=BACKOFF;}}\nself.handshakeErr=function(){if(Math.round(Math.log(backoff)/Math.log(BACKOFF))==7){return self.close()}\nif(self.opened){handshakeTimer=setTimeout(self.handshake,backoff);backoff*=2;}}\nself.sendCb=function(){self.packetsInFlight=null;backoff=BACKOFF;if(self.opened){if(self.buffer){self.doSend();}}}\nself.sendErr=function(){if(Math.round(Math.log(backoff)/Math.log(BACKOFF))==7){return self.close()}\nif(self.opened){sendTimer=setTimeout(self.doSend,backoff);backoff*=BACKOFF;}}\nself.cometCb=function(data){if(self.opened){self.processPackets(data);self.reconnect();}}\nself.cometErr=function(){if(Math.round(Math.log(cometBackoff)/Math.log(BACKOFF))==7){return self.close()}\nif(self.opened){cometTimer=setTimeout(self.reconnect,cometBackoff);cometBackoff*=2;}}}\nvar transports={};transports.xhr=function(cspId,url){var self=this;Transport.call(self,cspId,url);var makeXhr=function(){if(window.XDomainRequest){return new XDomainRequest();}\nif(window.XMLHttpRequest){return new XMLHttpRequest();}\nif(window.ActiveXObject){return new ActiveXObject(\"Msxml2.XMLHTTP\");}\nthrow new Error(\"XHR is not supported in this environment\");}\nvar sendXhr=makeXhr();var cometXhr=makeXhr();if(!csp.util.isSameDomain(url,location.toString())){if(!window.XDomainRequest)\nif(sendXhr.withCredentials===undefined){throw new Error(\"Invalid cross-domain transport\");}}\nvar makeRequest=function(type,url,args,cb,eb,timeout){var xhr;if(type=='send'){xhr=sendXhr;}\nif(type=='comet'){xhr=cometXhr;}\nurl+=\"?\";for(key in args){if(key!='d'){url+=key+'='+args[key]+'&';}}\nif(url.match('\\\\?$'))\n{url=url.slice(0,url.length-1);}\nvar payload=\"\";if(args.d){payload=args.d;}\nxhr.open('POST',self.url+url,true);xhr.setRequestHeader('Content-Type','text/plain')\nvar aborted=false;var timer=null;xhr.onreadystatechange=function(){try{}catch(e){}\nif(aborted){return eb();}\nif(xhr.readyState==4){try{if(xhr.status==200||xhr.status==0){clearTimeout(timer);var data=JSON.parse(xhr.responseText.substring(1,xhr.responseText.length-1));}}catch(e){}\nif(data){try{cb(data);}catch(e){setTimeout(function(){throw e;},0);}\nreturn;}\ntry{}catch(e){}\nreturn eb();}}\nif(timeout){timer=setTimeout(function(){aborted=true;xhr.abort();},timeout*1000);}\nxhr.send(payload)}\nthis.handshake=function(){self.opened=true;makeRequest(\"send\",\"/handshake\",{d:\"{}\"},self.handshakeCb,self.handshakeErr,10);}\nthis.doSend=function(){var args;if(!self.packetsInFlight){self.packetsInFlight=self.toPayload(self.buffer)\nself.buffer=\"\";}\nargs={s:self.sessionKey,d:self.packetsInFlight};makeRequest(\"send\",\"/send\",args,self.sendCb,self.sendErr,10);}\nthis.reconnect=function(){var args={s:self.sessionKey,a:self.lastEventId}\nmakeRequest(\"comet\",\"/comet\",args,self.cometCb,self.cometErr,40);}\nthis.toPayload=function(data){var payload=JSON.stringify([[++self.lastSentId,1,base64.encode(data)]]);return payload}}\nif(!global.csp){global.csp={}}\nglobal.csp._jsonp={}\nvar _jsonpId=0;function setJsonpCallbacks(cb,eb){global.csp._jsonp['cb'+(++_jsonpId)]=cb;global.csp._jsonp['eb'+(_jsonpId)]=eb;return _jsonpId;}\nfunction removeJsonpCallback(id){delete global.csp._jsonp['cb'+id];delete global.csp._jsonp['eb'+id];}\nfunction getJsonpErrbackPath(id){return'parent.csp._jsonp.eb'+id;}\nfunction getJsonpCallbackPath(id){return'parent.csp._jsonp.cb'+id;}\ntransports.jsonp=function(cspId,url){var self=this;Transport.call(self,cspId,url);var createIframe=function(){var i=document.createElement(\"iframe\");i.style.display='block';i.style.width='0';i.style.height='0';i.style.border='0';i.style.margin='0';i.style.padding='0';i.style.overflow='hidden';i.style.visibility='hidden';return i;}\nvar ifr={'bar':createIframe(),'send':createIframe(),'comet':createIframe()};var killLoadingBar=function(){window.setTimeout(function(){document.body.appendChild(ifr.bar);document.body.removeChild(ifr.bar);},0);}\nvar rId=0;var makeRequest=function(rType,url,args,cb,eb,timeout){args.n=Math.random();window.setTimeout(function(){var temp=ifr[rType];var doc=temp.contentDocument||temp.contentWindow.document||temp.document;var head=doc.getElementsByTagName('head')[0]||doc.getElementsByTagName('body')[0];var errorSuppressed=false;function errback(isIe){if(!isIe){var scripts=doc.getElementsByTagName('script');var s1=doc.getElementsByTagName('script')[0];var s2=doc.getElementsByTagName('script')[1];s1.parentNode.removeChild(s1);s2.parentNode.removeChild(s2);}\nremoveJsonpCallback(jsonpId);if(!errorSuppressed&&self.opened){eb.apply(null,arguments);}}\nfunction callback(){errorSuppressed=true;if(self.opened){cb.apply(null,arguments);}\nelse{}}\nvar jsonpId=setJsonpCallbacks(callback,errback);url+='?'\nfor(key in args){url+=key+'='+args[key]+'&';}\nif(rType==\"send\"){url+='rs=;&rp='+getJsonpCallbackPath(jsonpId);}\nelse if(rType==\"comet\"){url+='bs=;&bp='+getJsonpCallbackPath(jsonpId);}\nvar s=doc.createElement(\"script\");s.src=self.url+url;head.appendChild(s);if(s.onreadystatechange===null){s.onreadystatechange=function(){if(s.readyState==\"loaded\"){errback(true);}}}\nelse{var s=doc.createElement(\"script\");s.innerHTML=getJsonpErrbackPath(jsonpId)+'(false);'\nhead.appendChild(s);killLoadingBar();}},0);}\nthis.handshake=function(){self.opened=true;setTimeout(function(){makeRequest(\"send\",\"/handshake\",{d:\"{}\"},self.handshakeCb,self.handshakeErr,10)},0);}\nthis.doSend=function(){var args;if(!self.packetsInFlight){self.packetsInFlight=self.toPayload(self.buffer)\nself.buffer=\"\";}\nargs={s:self.sessionKey,d:self.packetsInFlight};makeRequest(\"send\",\"/send\",args,self.sendCb,self.sendErr,10);}\nthis.reconnect=function(){var args={s:self.sessionKey,a:self.lastEventId}\nmakeRequest(\"comet\",\"/comet\",args,self.cometCb,self.cometErr,40);}\nthis.toPayload=function(data){var payload=JSON.stringify([[++self.lastSentId,1,base64.encode(data)]]);return payload}\ndocument.body.appendChild(ifr.send);document.body.appendChild(ifr.comet);killLoadingBar();}}).call(typeof(exports)!='undefined'?exports:(function(){window.csp={};return csp;})(),typeof(global)=='undefined'?window:global)"},'jsio.protocols.rtjp':{"url":"jsio/protocols/rtjp.js","src":"\nrequire('jsio',['Class','bind']);require('jsio.interfaces');require('jsio.logging')\nrequire('jsio.protocols.delimited',['DelimitedProtocol'])\nvar logger=jsio.logging.getLogger('RTJPProtocol')\nexports.RTJPProtocol=Class(DelimitedProtocol,function(supr){this.init=function(){supr(this,'init',['\\n']);this.frameId=0;}\nthis.connectionMade=function(){logger.debug(\"connectionMade\");}\nvar error=function(e){setTimeout(function(){throw e;},0);}\nthis.frameReceived=function(id,name,args){}\nthis.sendFrame=function(name,args){if(!args){args={}}\nlogger.debug('sendFrame',name,args);this.transport.write(JSON.stringify([++this.frameId,name,args])+'\\r\\n');return this.frameId;}\nthis.lineReceived=function(line){try{var frame=JSON.parse(line);if(frame.length!=3){return error.call(this,\"Invalid frame length\");}\nif(typeof(frame[0])!=\"number\"){return error.call(this,\"Invalid frame id\");}\nif(typeof(frame[1])!=\"string\"){return error.call(this,\"Invalid frame name\");}\nif(typeof(frame[2])!=\"object\"){return error.call(this,\"Invalid frame args\");}\nlogger.debug(\"frameReceived:\",frame[0],frame[1],frame[2]);this.frameReceived(frame[0],frame[1],frame[2]);}catch(e){error.call(this,e);}}\nthis.connectionLost=function(){log('conn lost');}});"},'hookbox':{"url":"hookbox.js","src":"\nrequire('jsio',['bind','Class'])\nrequire('jsio',{'connect':'jsioConnect'})\nrequire('jsio.protocols.rtjp',['RTJPProtocol'])\nrequire('jsio.logging');var logger=jsio.logging.getLogger('hookbox');exports.logging=jsio.logging\nexports.connect=function(url,cookieString){var p=new HookBoxProtocol(url,cookieString);jsioConnect(p,'csp',{url:url})\nreturn p;}\nvar Subscription=Class(function(supr){this.init=function(destination,errorId){this.destination=destination;this.canceled=false;this._errorId=errorId}\nthis.onPublish=function(frame){}\nthis.onSetup=function(frame){}\nthis.onFailure=function(frame){}\nthis.getDestination=function(){return this.destination;}\nthis.cancel=function(){if(!this.canceled){this.canceled=false;logger.debug('calling this._onCancel()');this._onCancel();}}\nthis._onCancel=function(){}})\nHookBoxProtocol=Class([RTJPProtocol],function(supr){this.onopen=function(){}\nthis.onclose=function(){}\nthis.onerror=function(){}\nthis.init=function(url,cookieString){supr(this,'init',[]);this.url=url;this.cookieString=cookieString||document.cookie;this.connected=false;this._subscriptions={}\nthis._publishes=[]\nthis._errors={}}\nthis.subscribe=function(channel_name){var s=new Subscription();var subscribers;s._onCancel=bind(this,function(){logger.debug('in this._onCancel');var i=subscribers.indexOf(s);subscribers.splice(i,1);if(!subscribers.length){delete this._subscriptions[channel_name];delete this._errors[fId];this.sendFrame('UNSUBSCRIBE',{channel_name:channel_name});}\ndelete s._onCancel;})\nif(subscribers=this._subscriptions[channel_name]){subscribers.push(s);}else{subscribers=[s];this._subscriptions[channel_name]=subscribers;if(this.connected){var fId=this.sendFrame('SUBSCRIBE',{channel_name:channel_name});this._errors[fId]=subscribers;}}\nreturn s;}\nthis.publish=function(channel_name,data){if(this.connected){this.sendFrame('PUBLISH',{channel_name:channel_name,payload:JSON.stringify(data)});}else{this._publishes.push([channel_name,data]);}}\nthis.connectionMade=function(){logger.debug('connectionMade');this.sendFrame('CONNECT',{cookie_string:this.cookieString});}\nthis.frameReceived=function(fId,fName,fArgs){switch(fName){case'CONNECTED':this.connected=true;for(key in this._subscriptions){var fId=this.sendFrame('SUBSCRIBE',{channel_name:key});this._errors[fId]=this._subscriptions[key];}\nwhile(this._publishes.length){var pub=this._publishes.splice(0,1)[0];this.publish.apply(this,pub);}\nthis.onopen();break;case'PUBLISH':var subscribers;if(subscribers=this._subscriptions[fArgs.destination]){for(var i=0,subscriber;subscriber=subscribers[i];++i){try{subscriber.onFrame(fArgs);}catch(e){setTimeout(function(){throw e;},0);}}}\nbreak;case'ERROR':this.onerror(fArgs);if(subs=this._errors[fArgs.reference_id]){for(var i=0,sub;sub=subs[i];++i){sub.cancel()\nsub.onFailure(fArgs.msg);}}\nbreak;}}\nthis.connectionLost=function(){logger.debug('connectionLost');this.connected=false;this.onclose();}\nthis.reconnect=function(){jsioConnect(this,this.url);}})"},'jsio.env.browser.csp':{"url":"jsio/env/browser/csp.js","src":"\nrequire('jsio',['Class','bind']);require('jsio.logging');require('jsio.interfaces');require('jsio.csp.client','CometSession');var logger=jsio.logging.getLogger('env.browser.csp');exports.Connector=Class(jsio.interfaces.Connector,function(){this.connect=function(){var conn=new CometSession();conn.onopen=bind(this,function(){logger.debug('conn has opened');this.onConnect(new Transport(conn));});conn.onclose=bind(this,function(code){logger.debug('conn closed without opening, code:',code);});logger.debug('open the conection');conn.connect(this._opts.url,{encoding:'plain'});}});var Transport=Class(jsio.interfaces.Transport,function(){this.init=function(conn){this._conn=conn;}\nthis.makeConnection=function(protocol){this._conn.onread=bind(protocol,'dataReceived');this._conn.onclose=bind(protocol,'connectionLost');}\nthis.write=function(data,encoding){this._conn.write(data);}\nthis.loseConnection=function(protocol){this._conn.close();}});"},'jsio.utf8':{"url":"jsio/utf8.js","src":"\nvar utf8=this.utf8=exports;;(function(){var UnicodeCodecError=function(message){this.message=message;};UnicodeCodecError.prototype.toString=function(){return'UnicodeCodecError'+(this.message?': '+this.message:'');};utf8.encode=function(unicode_string){try{return unescape(encodeURIComponent(unicode_string));}\ncatch(err){throw new UnicodeCodecError('invalid input string');};};utf8.decode=function(bytes){if(/[^\\x00-\\xFF]/.test(bytes)){throw new UnicodeCodecError('invalid utf-8 bytes');};var len,len_parsed;len=len_parsed=bytes.length;var last=len-1;if(bytes.charCodeAt(last)>=0x80){for(var i=1;i<=3;i++){if(bytes.charCodeAt(len-i)>=0xC0){len_parsed=len-i;break;};};try{decodeURIComponent(escape(bytes.slice(len_parsed)));len_parsed=len;}\ncatch(err){};};try{return[decodeURIComponent(escape(bytes.slice(0,len_parsed))),len_parsed];}\ncatch(err){throw new UnicodeCodecError('invalid utf-8 bytes');};};});"}};var pre_require=[];if(typeof exports=='undefined'){exports={};window.jsio=exports;}
exports.getEnvironment=function(){if(typeof(node)!=='undefined'&&node.version){return'node';}
return'browser';};exports.bind=function(context,method){var args=Array.prototype.slice.call(arguments,2);return function(){method=(typeof method=='string'?context[method]:method);return method.apply(context,args.concat(Array.prototype.slice.call(arguments,0)))}};var bind=exports.bind;exports.Class=function(parent,proto){if(!parent){throw new Error('parent or prototype not provided');}
if(!proto){proto=parent;}
else if(parent instanceof Array){proto.prototype={};for(var i=0,p;p=parent[i];++i){for(var item in p.prototype){if(!(item in proto.prototype)){proto.prototype[item]=p.prototype[item];}}}
parent=parent[0];}else{proto.prototype=parent.prototype;}
var cls=function(){if(this.init){this.init.apply(this,arguments);}}
cls.prototype=new proto(function(context,method,args){var args=args||[];var target=parent;while(target=target.prototype){if(target[method]){return target[method].apply(context,args);}}
throw new Error('method '+method+' does not exist');});cls.prototype.constructor=cls;return cls;}
var modulePathCache={}
var getModulePathPossibilities=function(pathString){var isModule=pathString.charAt(pathString.length-1)=='.';var segments=pathString.split('.')
var modPath=segments.join('/');var out;if(segments[0]in modulePathCache){out=[[modulePathCache[segments[0]]+'/'+modPath+(isModule?'__init__.js':'.js'),null]]}else{out=[];for(var i=0,path;path=exports.path[i];++i){out.push([path+'/'+modPath+(isModule?'__init__.js':'.js'),path])}}
return out;}
exports.path=['.'];switch(exports.getEnvironment()){case'node':var nodeRequire=require;exports.log=function(){for(var i=0,item;item=arguments[i];++i){if(typeof(item)=='object'){arguments[i]=JSON.stringify(arguments[i]);}}
node.stdio.writeError([].slice.call(arguments,0).join(' ')+"\n");}
window=process;var compile=function(context,args){var fn=node.compile("function(_){with(_){delete _;(function(){"+args.src+"\n})()}}",args.url);fn.call(context.exports,context);}
var windowCompile=function(context,args){var fn=node.compile("function(_){with(_){with(_.window){delete _;(function(){"+args.src+"\n})()}}}",args.url);fn.call(context.exports,context);}
var cwd=node.cwd();var makeRelative=function(path){var i=path.match('^'+cwd);if(i&&i[0]==cwd){var offset=path[cwd.length]=='/'?1:0
return path.slice(cwd.length+offset);}
return path;}
var getModuleSourceAndPath=function(pathString){var baseMod=pathString.split('.')[0];var urls=getModulePathPossibilities(pathString);var cwd=node.cwd()+'/';for(var i=0,url;url=urls[i];++i){var cachePath=url[1];var url=url[0];try{var out={src:node.fs.cat(url,"utf8").wait(),url:url};if(!(baseMod in modulePathCache)){modulePathCache[baseMod]=cachePath;}
return out;}catch(e){}}
throw new Error("Module not found: "+pathString);}
var segments=__filename.split('/');var jsioPath=segments.slice(0,segments.length-2).join('/');if(jsioPath){exports.path.push(jsioPath);modulePathCache.jsio=jsioPath;}else{modulePathCache.jsio='.';}
break;default:exports.log=function(){if(typeof console!='undefined'&&console.log){console.log.apply(console,arguments);}}
var compile=function(context,args){var code="var fn = function(_){with(_){delete _;(function(){"+args.src+"\n}).call(this)}}\n//@ sourceURL="+args.url;eval(code);fn.call(context.exports,context);}
var windowCompile=function(context,args){var f="var fn = function(_){with(_){with(_.window){delete _;(function(){"+args.src+"\n}).call(this)}}}\n//@ sourceURL="+args.url;eval(f);fn.call(context.exports,context);}
var makeRelative=function(path){return path;}
var createXHR=function(){return window.XMLHttpRequest?new XMLHttpRequest():window.ActiveXObject?new ActiveXObject("Msxml2.XMLHTTP"):null;}
var getModuleSourceAndPath=function(pathString){if(preloaded_source[pathString]){return preloaded_source[pathString];}
var baseMod=pathString.split('.')[0];var urls=getModulePathPossibilities(pathString);for(var i=0,url;url=urls[i];++i){var cachePath=url[1];var url=url[0];var xhr=createXHR();var failed=false;try{xhr.open('GET',url,false);xhr.send(null);}catch(e){failed=true;}
if(failed||xhr.status==404||xhr.status==-1100||false)
{continue;}
if(!(baseMod in modulePathCache)){modulePathCache[baseMod]=cachePath;}
return{src:xhr.responseText,url:url};}
throw new Error("Module not found: "+pathString);}
try{var scripts=document.getElementsByTagName('script');for(var i=0,script;script=scripts[i];++i){if(/jsio\/jsio\.js$/.test(script.src)){var segments=script.src.split('/');var jsioPath=segments.slice(0,segments.length-2).join('/')||'.';exports.path.push(jsioPath);modulePathCache.jsio=jsioPath;break;}}}catch(e){}
break;}
exports.basePath=exports.path[exports.path.length-1];var modules={jsio:exports};var _require=function(external,context,path,pkg,what){var origPkg=pkg;if(pkg.charAt(0)=='.'){pkg=pkg.slice(1);var segments=path.split('.');while(pkg.charAt(0)=='.'){pkg=pkg.slice(1);segments.pop();}
var prefix=segments.join('.');if(prefix){pkg=segments.join('.')+'.'+pkg;}}
var segments=pkg.split('.');if(!(pkg in modules)){var result=getModuleSourceAndPath(pkg);var newRelativePath=segments.slice(0,segments.length-1).join('.');var newContext={};if(!external){newContext.exports={};newContext.global=window;newContext.require=bind(this,_require,false,newContext,newRelativePath);newContext.require.__jsio=true;var tmp=result.url.split('/')
newContext.require.__dir=makeRelative(tmp.slice(0,tmp.length-1).join('/'));newContext.require.__path=makeRelative(result.url);newContext.external=bind(this,_require,true,newContext,newRelativePath);newContext.jsio={require:newContext.require,external:newContext.external};compile(newContext,result);modules[pkg]=newContext.exports;}else{newContext['window']={};if(what instanceof Array){for(var i=0,key;key=what[i];++i){newContext['window'][key]=null;}}else if(what instanceof Object){for(var key in what){newContext['window'][key]=null;}}else{newContext['window'][what]=null;}
windowCompile(newContext,result);modules[pkg]=newContext.window;}}
if(what=='*'){for(var i in modules[pkg]){context[i]=modules[pkg][i];}}else if(!what){var segments=origPkg.split('.');while(segments[segments.length-1]==""){segments.pop()}
var c=context;var len=segments.length-1;for(var i=0,segment;(segment=segments[i])&&i<len;++i){if(!segment)continue;if(!c[segment]){c[segment]={};}
c=c[segment]}
c[segments[len]]=modules[pkg];}else if(typeof what=='string'){context[what]=modules[pkg][what];}else if(what.constructor==Object){for(var item in what){context[what[item]]=modules[pkg][item];}}else{for(var i=0,item;item=what[i];++i){context[item]=modules[pkg][item];}}}
exports.require=bind(this,_require,false,window,'');exports.external=bind(this,_require,true,window,'');var _localContext={jsio:{}};var jsio=_localContext.jsio;var require=bind(this,_require,false,_localContext,'');require('jsio.env.');exports.listen=function(server,transportName,opts){var listener=new(jsio.env.getListener(transportName))(server,opts);listener.listen();return listener;}
exports.connect=function(protocolInstance,transportName,opts){var connector=new(jsio.env.getConnector(transportName))(protocolInstance,opts);connector.connect();return connector;}
exports.quickServer=function(protocolClass){require('jsio.interfaces');return new jsio.interfaces.Server(protocolClass);}
for(var i=0,target;target=pre_require[i];++i){exports.require(target);}})();"use strict";if(!this.JSON){this.JSON={};}
(function(){function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+
partial.join(',\n'+gap)+'\n'+
mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==='string'){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+
mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());jsio.require("hookbox");delete jsio;